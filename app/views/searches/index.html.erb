<body class="mypage">
  <h1>動画を探す</h1>

  <%= form_with url: searches_path, method: :get do |f| %>
    <%= f.text_field :keyword, placeholder: "検索ワードを入力" %>
    <%= f.submit "検索" %>
  <% end %>

  <% if params[:keyword].present? %>
    <h2>検索ワード: <%= params[:keyword] %></h2>
  <% end %>

  <% if @videos.present? %>
    <% @videos.each do |video| %>
      <% title = video["desc"] || video["title"] || "タイトルなし" %>
      <% video_id = video["id"] %>

      <div class="video-item" style="margin-bottom: 40px;">

      <!-- Creator 情報追加 -->
      <% creator = video["author"] rescue nil %>
      <% if creator.present? %>
        <% avatar = creator["avatar_larger"] || creator["avatar_medium"] || creator["avatar_thumb"] || creator["avatar"] %>
        <% nickname = creator["nickname"] rescue nil %>
        <% username = creator["unique_id"] rescue nil %>

            <div>
              <strong><%= nickname %></strong><br>
              <% if username.present? %>
                @<%= username %>
              <% end %>
            </div>
        </div>
      <% end %>
        <p>タイトル: <%= title %></p>

        <% if video_id.present? %>
          <!-- TikTok埋め込み -->
          <iframe
            src="https://www.tiktok.com/embed/v2/<%= video_id %>"
            width="360"
            height="640"
            frameborder="0"
            allowfullscreen>
          </iframe>

          <!-- 保存ボタン -->
          <%= form_with model: SavedVideo.new, url: saved_videos_path, method: :post, data: { turbo: true } do |f| %>
            <%= f.hidden_field :title, value: title %>
            <%= f.hidden_field :url, value: "https://www.tiktok.com/embed/v2/#{video_id}" %>
            <%= f.hidden_field :nickname, value: nickname %>
            <%= f.hidden_field :username, value: username %>
            <%= f.submit "保存", class: "btn btn-saved" %>
          <% end %>

        <% else %>
          <p>▶️ 埋め込みURLが見つかりません。</p>
        <% end %>
      </div>
    <% end %>
  <% else %>
    <p>動画が見つかりませんでした。</p>
  <% end %>

  <div class="actions">
    <%= link_to "マイページ", mypage_path, class: "btn btn-mypage" %>
  </div>
  <% if @videos.present? && @videos.size >= 11 %>
    <div class="pagination">
      <%= link_to "もっと見る", searches_path(keyword: params[:keyword], page: @next_page), class: "btn btn-loadmore" %>
    </div>
  <% end %>
</body>